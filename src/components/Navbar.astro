---
// components/Navbar.astro
---

<nav
    class="mx-auto px-6 py-4 fixed top-0 left-0 right-0 rounded-lg transition-all duration-300 
    w-[calc(100%-40px)] m-2 backdrop-blur-lg bg-dark-card/90 dark:bg-dark-card/90 light:bg-light-card/90
    border border-cyber-blue/30 dark:border-cyber-blue/30 light:border-cyber-pink/30 
    shadow-cyber dark:shadow-cyber light:shadow-cyber-pink z-20"
>
    <div class="flex justify-between items-center">
        <div class="flex items-center">
            <a
                href="/"
                class="flex items-center font-cyber font-medium text-cyber-blue dark:text-cyber-blue light:text-cyber-pink"
            >
                <div class="h-12 w-12 mr-3 rounded bg-dark-card border border-cyber-blue/50 dark:border-cyber-blue/50 light:border-cyber-pink/50 flex items-center justify-center overflow-hidden cyber-scanline">
                    <img
                        src="/images/logo.png"
                        alt="Kanari Blog Logo"
                        class="h-10 w-10 object-cover"  
                    />
                </div>
                <span class="text-xl relative cyber-glitch">KANARI_NETWORK</span>
            </a>
        </div>
        <div class="flex items-center sm:space-x-4">
            <div class="sm:hidden">
                <button
                    id="mobile-menu-button"
                    aria-label="Toggle mobile menu"
                    aria-expanded="false"
                    class="p-2 rounded-md text-cyber-blue dark:text-cyber-blue light:text-cyber-pink focus:outline-none"
                >
                    <svg
                        class="h-6 w-6"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        aria-hidden="true"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
            <div class="hidden sm:flex sm:items-center sm:space-x-4">
                <button
                    onclick="window.open('https://github.com/kanari-network', '_blank', 'noopener noreferrer')"
                    aria-label="Visit Kanari Network on GitHub"
                    class="bg-dark-card text-cyber-blue border border-cyber-blue/50 px-3 py-2 rounded-sm text-sm font-cyber flex items-center hover:bg-cyber-blue/10 transition-colors focus:outline-none relative overflow-hidden group"
                >
                    <span class="absolute inset-0 bg-cyber-blue/20 opacity-0 group-hover:opacity-100 transition-opacity"></span>
                    <i class="fab fa-github mr-2" aria-hidden="true"></i>
                    <span>GITHUB</span>
                </button>
                <button
                    onclick="window.open('https://bsky.app/profile/kanari.network', '_blank', 'noopener noreferrer')"
                    aria-label="Visit Kanari Network on Bluesky"
                    class="bg-dark-card text-cyber-blue border border-cyber-blue/50 px-3 py-2 rounded-sm text-sm font-cyber flex items-center hover:bg-cyber-blue/10 transition-colors focus:outline-none relative overflow-hidden group"
                >
                    <span class="absolute inset-0 bg-cyber-blue/20 opacity-0 group-hover:opacity-100 transition-opacity"></span>
                    <img
                        src="/Bluesky_Logo.svg"
                        alt=""
                        class="w-5 h-5 mr-2"
                        aria-hidden="true"
                    />
                    <span>BLUESKY</span>
                </button>
                <button
                    onclick="window.open('https://discord.com/invite/QU6fTacXab', '_blank', 'noopener noreferrer')"
                    class="bg-dark-card text-cyber-blue border border-cyber-blue/50 px-3 py-2 rounded-sm text-sm font-cyber flex items-center hover:bg-cyber-blue/10 transition-colors focus:outline-none relative overflow-hidden group"
                >
                    <span class="absolute inset-0 bg-cyber-blue/20 opacity-0 group-hover:opacity-100 transition-opacity"></span>
                    <i class="fab fa-discord mr-2"></i>
                    <span>DISCORD</span>
                </button>
                <button
                    id="mode-toggle"
                    aria-label="Toggle dark mode"
                    class="relative bg-dark-card text-cyber-blue p-2 rounded-sm flex items-center justify-center border border-cyber-blue/50 dark:border-cyber-blue/50 light:border-cyber-pink/50 overflow-hidden transition-all duration-300 hover:bg-cyber-blue/10"
                >
                    <i
                        id="mode-icon"
                        class="fas fa-moon relative z-10"
                        aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </div>
    <div id="mobile-menu" class="sm:hidden hidden mt-4 border border-cyber-blue/30 dark:border-cyber-blue/30 light:border-cyber-pink/30 bg-dark-card/90 dark:bg-dark-card/90 light:bg-light-card/90 rounded-sm p-2">
        <div class="px-2 py-3 flex justify-center space-x-4">
            {/* GitHub Button */}
            <button
                onclick="window.open('https://github.com/kanari-network', '_blank', 'noopener noreferrer')"
                class="relative text-cyber-blue dark:text-cyber-blue light:text-cyber-pink p-3 rounded-sm flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:bg-cyber-blue/10"
            >
                <i class="fab fa-github text-xl"></i>
            </button>
    
            {/* Bluesky Button */}
            <button
                onclick="window.open('https://bsky.app/profile/kanari.network', '_blank', 'noopener noreferrer')"
                class="relative text-cyber-blue dark:text-cyber-blue light:text-cyber-pink p-3 rounded-sm flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:bg-cyber-blue/10"
            >
                <img src="/Bluesky_Logo.svg" alt="Bluesky Logo" class="w-5 h-5 filter" />
            </button>
    
            {/* Discord Button */}
            <button
                onclick="window.open('https://discord.com/invite/QU6fTacXab', '_blank', 'noopener noreferrer')"
                class="relative text-cyber-blue dark:text-cyber-blue light:text-cyber-pink p-3 rounded-sm flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:bg-cyber-blue/10"
            >
                <i class="fab fa-discord text-xl"></i>
            </button>
    
            {/* Theme Toggle Button */}
            <button
                id="mobile-mode-toggle"
                class="relative text-cyber-blue dark:text-cyber-blue light:text-cyber-pink p-3 rounded-sm flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:bg-cyber-blue/10"
            >
                <i id="mobile-mode-icon" class="fas fa-moon text-xl"></i>
            </button>
        </div>
    </div>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const modeToggle = document.getElementById("mode-toggle");
        const modeIcon = document.getElementById("mode-icon");
        const mobileModeToggle = document.getElementById("mobile-mode-toggle");
        const mobileModeIcon = document.getElementById("mobile-mode-icon");
        const modes = ["dark", "light"];

        function getCookie(name: string): string | null {
            try {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2)
                    return parts.pop()?.split(";").shift() || null;
                return null;
            } catch (e) {
                console.error("Error reading cookie:", e);
                return null;
            }
        }

        function setCookie(name: string, value: string, days: number): void {
            try {
                const d = new Date();
                d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
                const expires = `expires=${d.toUTCString()}`;
                document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
                localStorage.setItem("preferredMode", value); // Backup to localStorage
            } catch (e) {
                console.error("Error setting cookie:", e);
            }
        }

        // Get the current mode with fallbacks
        function getInitialMode(): string {
            const cookieMode = getCookie("mode");
            const localMode = localStorage.getItem("preferredMode");
            const systemPrefersDark = window.matchMedia(
                "(prefers-color-scheme: dark)",
            ).matches;

            return (
                cookieMode ||
                localMode ||
                (systemPrefersDark ? "dark" : "light")
            );
        }

        let currentModeIndex = modes.indexOf(getInitialMode());
        if (currentModeIndex === -1) currentModeIndex = 0;

        // Apply the current mode
        document.documentElement.classList.remove(...modes);
        document.documentElement.classList.add(modes[currentModeIndex]);
        updateIcons();

        function updateIcons(): void {
            if (modes[currentModeIndex] === "dark") {
                modeIcon?.classList.remove("fa-sun");
                modeIcon?.classList.add("fa-moon");
                mobileModeIcon?.classList.remove("fa-sun");
                mobileModeIcon?.classList.add("fa-moon");
                
                // Update button colors for dark mode
                modeToggle?.classList.remove("text-cyber-pink");
                modeToggle?.classList.add("text-cyber-blue");
                mobileModeToggle?.classList.remove("text-cyber-pink");
                mobileModeToggle?.classList.add("text-cyber-blue");
            } else {
                modeIcon?.classList.remove("fa-moon");
                modeIcon?.classList.add("fa-sun");
                mobileModeIcon?.classList.remove("fa-moon");
                mobileModeIcon?.classList.add("fa-sun");
                
                // Update button colors for light mode
                modeToggle?.classList.remove("text-cyber-blue");
                modeToggle?.classList.add("text-cyber-pink");
                mobileModeToggle?.classList.remove("text-cyber-blue");
                mobileModeToggle?.classList.add("text-cyber-pink");
            }
        }

        function toggleMode(): void {
            document.documentElement.classList.remove(modes[currentModeIndex]);
            currentModeIndex = (currentModeIndex + 1) % modes.length;
            const newMode = modes[currentModeIndex];
            document.documentElement.classList.add(newMode);
            updateIcons();
            setCookie("mode", newMode, 30); // Extended to 30 days
        }

        modeToggle?.addEventListener("click", toggleMode);
        mobileModeToggle?.addEventListener("click", toggleMode);
    });
</script>
