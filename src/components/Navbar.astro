---
// components/Navbar.astro
---

<nav
    class="mx-auto px-6 py-4 fixed top-0 left-0 right-0 rounded-lg transition-all duration-300 w-[calc(100%-40px)] m-2 backdrop-blur-md bg-opacity-80 shadow-lg z-20"
>
    <div class="flex justify-between items-center">
        <div class="flex-shrink-0">
            <a
                href="/"
                class="text-2xl font-bold text-gray-800 dark:text-gray-900 light-orange:text-orange-600 flex items-center rounded"
            >
                <img
                    src="/images/logo.png"
                    alt="Kanari Blog Logo"
                    class="h-8 w-8 mr-2 rounded"
                />
                Kanari Blog
            </a>
        </div>
        <div class="flex items-center sm:space-x-4">
            <div class="sm:hidden">
                <button
                    id="mobile-menu-button"
                    class="p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
                    <svg
                        class="h-6 w-6 light:text-purple-600"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16m-7 6h7"
                        ></path>
                    </svg>
                </button>
            </div>
            <div class="hidden sm:flex sm:items-center sm:space-x-4 ">
                <button
                    onclick="window.open('https://github.com/kanari-network', '_blank', 'noopener noreferrer')"
                    class="bg-gray-800 text-white px-3 py-2 rounded-md text-sm font-medium flex items-center dark:bg-gray-700 light-orange:bg-orange-600 light-orange:text-white"
                >
                    <i class="fab fa-github mr-2"></i>
                    GitHub
                </button>
                <button
                    onclick="window.open('https://bsky.app/profile/kanari.network', '_blank', 'noopener noreferrer')"
                    class="bg-blue-500 text-white px-3 py-2 rounded-md text-sm font-medium flex items-center dark:bg-blue-600 light-orange:bg-orange-600 light-orange:text-white"
                >
                    <img src="/Bluesky_Logo.svg" alt="Bluesky Logo" class="w-5 h-5 mr-2" />
                    Bluesky
                </button>
                <button
                    onclick="window.open('https://discord.com/invite/QU6fTacXab', '_blank', 'noopener noreferrer')"
                    class="bg-indigo-500 text-white px-3 py-2 rounded-md text-sm font-medium flex items-center dark:bg-indigo-600 light-orange:bg-orange-600 light-orange:text-white"
                >
                    <i class="fab fa-discord mr-2"></i>
                    Discord
                </button>
                <button
                    id="mode-toggle"
                    class="relative bg-gray-200 text-gray-800 p-3 rounded-full flex items-center justify-center dark:bg-gray-800 dark:text-gray-100 light-orange:bg-orange-600 light-orange:text-white overflow-hidden transition-all duration-300 transform hover:scale-105"
                >
                    <i id="mode-icon" class="fas fa-moon relative z-10"></i>
                </button>
            </div>
        </div>
    </div>
    <div
        id="mobile-menu"
        class="sm:hidden hidden mt-2 light-orange:bg-orange-100 rounded "
    >
        <div class="px-2 py-3 flex justify-center space-x-4">
            <button
                onclick="window.open('https://github.com/kanari-network', '_blank', 'noopener noreferrer')"
                class="relative text-gray-800 dark:text-black light-orange:text-gray-800 p-3 rounded-full flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:scale-105"
            >
                <span class="absolute inset-0 bg-gradient-to-r from-gray-400 to-gray-600 opacity-0 transition-opacity duration-300 hover:opacity-100 rounded-full"></span>
                <i class="fab fa-github text-xl relative z-10"></i>
            </button>
            <button
                onclick="window.open('https://bsky.app/profile/kanari.network', '_blank', 'noopener noreferrer')"
                class="relative text-black dark:text-black light-orange:text-gray-800 p-3 rounded-full flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:scale-105"
                >
                    <span class="absolute inset-0 bg-gradient-to-r from-black to-gray-800 opacity-0 transition-opacity duration-300 hover:opacity-100 rounded-full"></span>
                    <img src="/Bluesky_Logo.svg" alt="Bluesky Logo" class="w-5 h-5 relative z-10" />
            </button>
            <button
                onclick="window.open('https://discord.com/invite/QU6fTacXab', '_blank', 'noopener noreferrer')"
                class="relative text-indigo-500 dark:text-indigo-600 light-orange:text-gray-800 p-3 rounded-full flex items-center justify-center overflow-hidden transition-all duration-300 transform hover:scale-105"
            >
                <span class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-indigo-600 opacity-0 transition-opacity duration-300 hover:opacity-100 rounded-full"></span>
                <i class="fab fa-discord text-xl relative z-10"></i>
            </button>
            <button
                id="mobile-mode-toggle"
                class="relative bg-gray-200 text-gray-800 p-3 rounded-full flex items-center justify-center dark:bg-gray-800 dark:text-gray-100 light-orange:bg-orange-600 light-orange:text-white overflow-hidden transition-all duration-300 transform hover:scale-105"
            >
                <span class="absolute inset-0 bg-gradient-to-r from-orange-400 to-pink-500 opacity-0 transition-opacity duration-300 hover:opacity-100 rounded-full"></span>
                <i id="mobile-mode-icon" class="fas fa-moon relative z-10"></i>
            </button>
        </div>
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modeToggle = document.getElementById('mode-toggle');
        const modeIcon = document.getElementById('mode-icon');
        const mobileModeToggle = document.getElementById('mobile-mode-toggle');
        const mobileModeIcon = document.getElementById('mobile-mode-icon');
        const modes = ['dark', 'light'];
    
        function getCookie(name: string): string | null {
            try {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop()?.split(';').shift() || null;
                return null;
            } catch (e) {
                console.error('Error reading cookie:', e);
                return null;
            }
        }
    
        function setCookie(name: string, value: string, days: number): void {
            try {
                const d = new Date();
                d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = `expires=${d.toUTCString()}`;
                document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
                localStorage.setItem('preferredMode', value); // Backup to localStorage
            } catch (e) {
                console.error('Error setting cookie:', e);
            }
        }
    
        // Get the current mode with fallbacks
        function getInitialMode(): string {
            const cookieMode = getCookie('mode');
            const localMode = localStorage.getItem('preferredMode');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            return cookieMode || localMode || (systemPrefersDark ? 'dark' : 'light');
        }
    
        let currentModeIndex = modes.indexOf(getInitialMode());
        if (currentModeIndex === -1) currentModeIndex = 0;
    
        // Apply the current mode
        document.documentElement.classList.remove(...modes);
        document.documentElement.classList.add(modes[currentModeIndex]);
        updateIcons();
    
        // Rest of the code remains the same...
        function updateIcons(): void {
            if (modes[currentModeIndex] === 'dark') {
                modeIcon?.classList.remove('fa-sun');
                modeIcon?.classList.add('fa-moon');
                mobileModeIcon?.classList.remove('fa-sun');
                mobileModeIcon?.classList.add('fa-moon');
            } else {
                modeIcon?.classList.remove('fa-moon');
                modeIcon?.classList.add('fa-sun');
                mobileModeIcon?.classList.remove('fa-moon');
                mobileModeIcon?.classList.add('fa-sun');
            }
        }
    
        function toggleMode(): void {
            document.documentElement.classList.remove(modes[currentModeIndex]);
            currentModeIndex = (currentModeIndex + 1) % modes.length;
            const newMode = modes[currentModeIndex];
            document.documentElement.classList.add(newMode);
            updateIcons();
            setCookie('mode', newMode, 30); // Extended to 30 days
        }
    
        modeToggle?.addEventListener('click', toggleMode);
        mobileModeToggle?.addEventListener('click', toggleMode);
    });
</script>